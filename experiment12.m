InputVoltage=xlsread('C:\Users\57035\Desktop\文件\大三下课程相关\自控实践2\实验1\实验一 伺服系统模型参数辨识\实验一扫频辨识\6.xlsx',1,'B1:B128721');
Frequency=xlsread('C:\Users\57035\Desktop\文件\大三下课程相关\自控实践2\实验1\实验一 伺服系统模型参数辨识\实验一扫频辨识\6.xlsx',1,'C1:C128721');
FeedbackAngle=xlsread('C:\Users\57035\Desktop\文件\大三下课程相关\自控实践2\实验1\实验一 伺服系统模型参数辨识\实验一扫频辨识\6.xlsx',1,'E1:E128721');
Index=[7,22900;...
       27580,36970;...
       39560,46190;...
       48430,53140;...
       54870,58680;...
       61400,62800;...
       66200,67000;...
       69800,70600;...
       73400,74200;...
       76400,77200;...
       79200,80000;...
       82200,82800;...
       84600,85200;...
       89400,90200;...
       91800,92400;...
       94400,95000;...
       96800,97600;...
       99400,100000;...
       102000,102600;...
       104400,105000;...
       107000,107600;...
       109400,110200;...
       112000,112400;...
       114600,115000;...
       116800,117400;...
       119400,120200;...
       121800,122600;...
       124400,125200;...
       126800,127600];
%选取的各频率下的数值范围，该数组保存下标，便于后续直接引用
for i3=1:1:29
    IV=fft(InputVoltage(Index(i3,1):Index(i3,2)));%对输入值进行fft
    IVF=abs(IV);
    IVFm=max(IVF);%求输入最大值
    FA1=fft(FeedbackAngle(Index(i3,1):Index(i3,2)));%对输出值进行fft
    FA1F=abs(FA1);
    FA1Fm=max(FA1F);%求输出最大值
    amp11(1,i3)=FA1Fm/IVFm;
    [ampp,p1]=max(IVF); 
    x=IV(p1);
    y=FA1(p1);
    a11(1,i3)=angle(y/x)*180/pi;%求相角
end
for k=1:29                               
    if (a11(1,k)>0)
        a11(1,k)=a11(1,k)-360;
    end
end
f=[0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20];  
AMP=20*log10(amp11);
subplot(2,1,1);
semilogx(f,AMP);%绘制幅频特性
grid on;
subplot(2,1,2);
semilogx(f,a11);%绘制相频特性
grid on
